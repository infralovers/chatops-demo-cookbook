#
# This file was generated by Chef for <%= node['fqdn'] %>.
# Do not modify this file by hand!
#

upstream lita {
  server 127.0.0.1:<%= @lita_port %>;
}

server {
  listen                <%= "#{@listen_address}:" if !@listen_address.nil? && !@listen_address.empty? %><%= @listen_port %>;

  server_name           <%= @server_name %> <%= @server_aliases.join(" ") %>;
  access_log            /var/log/nginx/<%= @server_name %>.access.log;

  ssl on;
  ssl_certificate <%= @ssl_cert_dir %>/<%= @ssl_cert_name %>;
  ssl_certificate_key <%= @ssl_key_dir %>/<%= @ssl_key_name %>;
  <% if @ssl_dhparam_name -%>
  ssl_dhparam <%= @ssl_cert_dir %>/<%= @ssl_dhparam_name %>;
  <% end %>
  ssl_session_timeout 1d;
  ssl_session_cache shared:SSL:50m;

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers 'AES256+EECDH:AES256+EDH';
  ssl_prefer_server_ciphers on;

  add_header Strict-Transport-Security max-age=31536000;

  ssl_stapling on;
  ssl_stapling_verify on;

  location / {
    proxy_pass http://lita;
  }
}